# åœ˜éšŠåˆªé™¤æ¬Šé™èªªæ˜

## ğŸ“‹ åŠŸèƒ½æ¦‚è¿°

åœ˜éšŠåˆªé™¤åŠŸèƒ½æ ¹æ“šç”¨æˆ¶èº«ä»½æœ‰ä¸åŒçš„è™•ç†æ–¹å¼ï¼š

### 1. **Admin (reyerchu@defintek.io)**
- âœ… **ç›´æ¥åˆªé™¤æ¬Šé™**ï¼šå¯ä»¥ç«‹å³åˆªé™¤ä»»ä½•åœ˜éšŠ
- âœ… åˆªé™¤å¾Œç„¡æ³•å¾©åŸ
- âœ… ç³»çµ±è¨˜éŒ„åˆªé™¤æ—¥èªŒ

### 2. **åœ˜éšŠæˆå“¡ï¼ˆåœ˜éšŠé ˜å°è€…æˆ–æœ‰ç·¨è¼¯æ¬Šé™çš„æˆå“¡ï¼‰**
- âš ï¸ **åƒ…èƒ½ç™¼é€åˆªé™¤è«‹æ±‚**ï¼šé»æ“Šåˆªé™¤æŒ‰éˆ•å¾Œï¼Œä¸æœƒç›´æ¥åˆªé™¤åœ˜éšŠ
- ğŸ“§ **è‡ªå‹•é€šçŸ¥ Admin**ï¼šç³»çµ±æœƒè‡ªå‹•ç™¼é€ email çµ¦ `reyerchu@defintek.io`
- â³ **ç­‰å¾…å¯©æ ¸**ï¼šéœ€è¦ admin æ‰¹å‡†å¾Œæ‰æœƒçœŸæ­£åˆªé™¤

---

## ğŸ”„ åˆªé™¤æµç¨‹

### åœ˜éšŠæˆå“¡åˆªé™¤æµç¨‹

```
åœ˜éšŠæˆå“¡é»æ“Šã€Œåˆªé™¤ã€
         â†“
  ç™¼é€åˆªé™¤è«‹æ±‚åˆ°è³‡æ–™åº«
         â†“
  Email é€šçŸ¥ Admin
  (reyerchu@defintek.io)
         â†“
  åœ˜éšŠæˆå“¡æ”¶åˆ°ç¢ºèªè¨Šæ¯ï¼š
  ã€Œåˆªé™¤è«‹æ±‚å·²ç™¼é€çµ¦ç®¡ç†å“¡ï¼Œè«‹ç­‰å¾…å¯©æ ¸ã€
         â†“
     [åœ˜éšŠä¿æŒå­˜åœ¨]
         â†“
  Admin ç™»å…¥å¾Œå°æŸ¥çœ‹è«‹æ±‚
         â†“
   Admin æ‰¹å‡† / æ‹’çµ•
         â†“
  [æ‰¹å‡†] â†’ åœ˜éšŠè¢«åˆªé™¤
  [æ‹’çµ•] â†’ åœ˜éšŠä¿æŒå­˜åœ¨
```

### Admin åˆªé™¤æµç¨‹

```
Admin é»æ“Šã€Œåˆªé™¤ã€
         â†“
    ç¢ºèªå°è©±æ¡†
         â†“
   åœ˜éšŠç«‹å³è¢«åˆªé™¤
         â†“
    è¨˜éŒ„åˆªé™¤æ—¥èªŒ
```

---

## ğŸ“§ Email é€šçŸ¥

ç•¶åœ˜éšŠæˆå“¡ç™¼èµ·åˆªé™¤è«‹æ±‚æ™‚ï¼ŒAdmin æœƒæ”¶åˆ° email é€šçŸ¥ï¼ŒåŒ…å«ä»¥ä¸‹è³‡è¨Šï¼š

- **åœ˜éšŠåç¨±**
- **åœ˜éšŠ ID**
- **è«‹æ±‚è€… Email**
- **è«‹æ±‚è€…èº«ä»½**ï¼ˆåœ˜éšŠé ˜å°è€… / åœ˜éšŠæˆå“¡ï¼‰
- **è«‹æ±‚æ™‚é–“**
- **ç®¡ç†å¾Œå°é€£çµ**

---

## ğŸ›ï¸ Admin ç®¡ç†å¾Œå°

### è¨ªå•è·¯å¾‘
```
https://hackathon.com.tw/admin/teams
```

### åŠŸèƒ½
- æŸ¥çœ‹æ‰€æœ‰å¾…è™•ç†çš„åˆªé™¤è«‹æ±‚
- æŸ¥çœ‹è«‹æ±‚è©³æƒ…ï¼ˆåœ˜éšŠåç¨±ã€è«‹æ±‚è€…ã€æ™‚é–“ï¼‰
- **æ‰¹å‡†åˆªé™¤**ï¼šç«‹å³åˆªé™¤è©²åœ˜éšŠ
- **æ‹’çµ•è«‹æ±‚**ï¼šä¿ç•™åœ˜éšŠï¼Œæ¨™è¨˜è«‹æ±‚ç‚ºå·²æ‹’çµ•

---

## ğŸ—„ï¸ è³‡æ–™åº«çµæ§‹

### Collection: `team-delete-requests`

æ¯å€‹åˆªé™¤è«‹æ±‚éƒ½æœƒå„²å­˜åœ¨ Firestore çš„ `team-delete-requests` collection ä¸­ï¼š

```typescript
{
  teamId: string;              // åœ˜éšŠ ID
  teamName: string;            // åœ˜éšŠåç¨±
  requestedBy: {
    userId: string;
    email: string;
    name: string;
    role: string;              // "åœ˜éšŠé ˜å°è€…" / "åœ˜éšŠæˆå“¡"
  };
  teamData: object;            // å®Œæ•´åœ˜éšŠè³‡æ–™ï¼ˆå‚™ä»½ï¼‰
  status: 'pending' | 'approved' | 'rejected';
  requestedAt: Timestamp;      // è«‹æ±‚æ™‚é–“
  approvedBy?: string;         // æ‰¹å‡†è€… UIDï¼ˆå¦‚æœæ‰¹å‡†ï¼‰
  approvedAt?: Timestamp;      // æ‰¹å‡†æ™‚é–“
  rejectedBy?: string;         // æ‹’çµ•è€… UIDï¼ˆå¦‚æœæ‹’çµ•ï¼‰
  rejectedAt?: Timestamp;      // æ‹’çµ•æ™‚é–“
}
```

---

## ğŸ” æ¬Šé™æª¢æŸ¥é‚è¼¯

### API: `DELETE /api/team-register/[teamId]`

```typescript
// 1. é©—è­‰ç”¨æˆ¶èº«ä»½
const userEmail = decodedToken.email;
const ADMIN_EMAIL = 'reyerchu@defintek.io';
const isAdmin = userEmail === ADMIN_EMAIL;

// 2. æª¢æŸ¥åœ˜éšŠæ¬Šé™
const isLeader = teamData.teamLeader?.userId === userId;
const hasMemberEditRight = teamData.teamMembers?.some(
  (member) => member.userId === userId && member.hasEditRight
);

// 3. æ±ºå®šåŸ·è¡Œæ–¹å¼
if (isAdmin) {
  // ç›´æ¥åˆªé™¤åœ˜éšŠ
  await db.collection('team-registrations').doc(teamId).delete();
  return { success: true, message: 'åœ˜éšŠå·²åˆªé™¤' };
} else if (isLeader || hasMemberEditRight) {
  // ç™¼é€åˆªé™¤è«‹æ±‚
  await db.collection('team-delete-requests').add({ ... });
  await sendDeleteRequestEmail(...);
  return { success: true, message: 'åˆªé™¤è«‹æ±‚å·²ç™¼é€çµ¦ç®¡ç†å“¡ï¼Œè«‹ç­‰å¾…å¯©æ ¸', isRequest: true };
} else {
  // ç„¡æ¬Šé™
  return { error: 'æ‚¨æ²’æœ‰æ¬Šé™åˆªé™¤æ­¤åœ˜éšŠ' };
}
```

---

## ğŸ“ ç›¸é—œæ–‡ä»¶

### Backend API
- `/pages/api/team-register/[teamId].ts` - è™•ç†åˆªé™¤è«‹æ±‚
- `/pages/api/admin/team-delete-requests.ts` - ç²å–æ‰€æœ‰åˆªé™¤è«‹æ±‚
- `/pages/api/admin/team-delete-requests/[requestId]/approve.ts` - æ‰¹å‡†åˆªé™¤
- `/pages/api/admin/team-delete-requests/[requestId]/reject.ts` - æ‹’çµ•åˆªé™¤

### Frontend Components
- `/components/TeamManagement.tsx` - åœ˜éšŠç®¡ç†çµ„ä»¶ï¼ˆè™•ç†åˆªé™¤æŒ‰éˆ•ï¼‰
- `/components/admin/TeamDeleteRequests.tsx` - Admin åˆªé™¤è«‹æ±‚åˆ—è¡¨çµ„ä»¶
- `/pages/admin/teams.tsx` - Admin åœ˜éšŠç®¡ç†é é¢

---

## âœ… æ¸¬è©¦æ­¥é©Ÿ

### æ¸¬è©¦ 1: åœ˜éšŠæˆå“¡è«‹æ±‚åˆªé™¤

1. ä»¥åœ˜éšŠæˆå“¡èº«ä»½ç™»å…¥
2. å‰å¾€åœ˜éšŠç®¡ç†é é¢
3. é»æ“Šã€Œåˆªé™¤ã€æŒ‰éˆ•
4. ç¢ºèªåˆªé™¤
5. **é æœŸçµæœ**ï¼š
   - é¡¯ç¤ºã€Œåˆªé™¤è«‹æ±‚å·²ç™¼é€çµ¦ç®¡ç†å“¡ï¼Œè«‹ç­‰å¾…å¯©æ ¸ã€
   - åœ˜éšŠä»ç„¶å­˜åœ¨ï¼ˆæœªè¢«åˆªé™¤ï¼‰
   - Admin æ”¶åˆ° email é€šçŸ¥

### æ¸¬è©¦ 2: Admin æŸ¥çœ‹ä¸¦æ‰¹å‡†åˆªé™¤è«‹æ±‚

1. ä»¥ `reyerchu@defintek.io` ç™»å…¥
2. å‰å¾€ `/admin/teams`
3. æŸ¥çœ‹ã€Œåœ˜éšŠåˆªé™¤è«‹æ±‚ã€å€å¡Š
4. é»æ“Šã€Œâœ“ æ‰¹å‡†åˆªé™¤ã€æŒ‰éˆ•
5. ç¢ºèªåˆªé™¤
6. **é æœŸçµæœ**ï¼š
   - åœ˜éšŠè¢«åˆªé™¤
   - åˆªé™¤è«‹æ±‚ç‹€æ…‹è®Šç‚º `approved`
   - åœ˜éšŠåˆ—è¡¨æ›´æ–°

### æ¸¬è©¦ 3: Admin ç›´æ¥åˆªé™¤åœ˜éšŠ

1. ä»¥ `reyerchu@defintek.io` ç™»å…¥
2. åœ¨ä»»ä½•åœ˜éšŠç®¡ç†é é¢é»æ“Šã€Œåˆªé™¤ã€
3. ç¢ºèªåˆªé™¤
4. **é æœŸçµæœ**ï¼š
   - åœ˜éšŠç«‹å³è¢«åˆªé™¤
   - é¡¯ç¤ºã€Œåœ˜éšŠå·²åˆªé™¤ã€
   - ä¸æœƒå‰µå»ºåˆªé™¤è«‹æ±‚

---

## ğŸ“ æ³¨æ„äº‹é …

1. **Email è¨­å®š**ï¼šéœ€è¦è¨­ç½® SMTP æˆ– SendGrid ç’°å¢ƒè®Šæ•¸æ‰èƒ½ç™¼é€ email é€šçŸ¥
   - `SMTP_HOST`, `SMTP_PORT`, `SMTP_USER`, `SMTP_PASS`
   - æˆ– `SENDGRID_API_KEY`
   
2. **Admin Email ç¡¬ç·¨ç¢¼**ï¼šç›®å‰ admin email æ˜¯ç¡¬ç·¨ç¢¼ç‚º `reyerchu@defintek.io`ï¼Œå¦‚éœ€ä¿®æ”¹è«‹æ›´æ–°ä»¥ä¸‹æ–‡ä»¶ï¼š
   - `/pages/api/team-register/[teamId].ts`
   - `/pages/api/admin/team-delete-requests.ts`
   - `/pages/api/admin/team-delete-requests/[requestId]/approve.ts`
   - `/pages/api/admin/team-delete-requests/[requestId]/reject.ts`

3. **è³‡æ–™å‚™ä»½**ï¼šåˆªé™¤è«‹æ±‚ä¸­åŒ…å«å®Œæ•´çš„ `teamData`ï¼Œå³ä½¿åœ˜éšŠè¢«åˆªé™¤ï¼Œä»å¯å¾ `team-delete-requests` collection ä¸­æŸ¥çœ‹åŸå§‹è³‡æ–™

4. **æ—¥èªŒè¨˜éŒ„**ï¼šæ‰€æœ‰åˆªé™¤æ“ä½œéƒ½æœƒè¨˜éŒ„åœ¨ `activity-logs` collection ä¸­ï¼ŒåŒ…æ‹¬ï¼š
   - `team_registration_delete_admin` - Admin ç›´æ¥åˆªé™¤
   - `team_delete_request` - åœ˜éšŠæˆå“¡ç™¼èµ·è«‹æ±‚
   - `team_delete_request_approved` - Admin æ‰¹å‡†è«‹æ±‚
   - `team_delete_request_rejected` - Admin æ‹’çµ•è«‹æ±‚

---

## ğŸ¯ ç¸½çµ

| ç”¨æˆ¶é¡å‹ | åˆªé™¤æŒ‰éˆ•è¡Œç‚º | å¯¦éš›çµæœ | Email é€šçŸ¥ |
|---------|------------|---------|-----------|
| **Admin (reyerchu@defintek.io)** | ç›´æ¥åˆªé™¤ | âœ… åœ˜éšŠç«‹å³è¢«åˆªé™¤ | âŒ ç„¡ |
| **åœ˜éšŠé ˜å°è€…** | ç™¼é€è«‹æ±‚ | â³ ç­‰å¾… Admin å¯©æ ¸ | âœ… é€šçŸ¥ Admin |
| **æœ‰ç·¨è¼¯æ¬Šé™çš„åœ˜éšŠæˆå“¡** | ç™¼é€è«‹æ±‚ | â³ ç­‰å¾… Admin å¯©æ ¸ | âœ… é€šçŸ¥ Admin |
| **ä¸€èˆ¬åœ˜éšŠæˆå“¡ï¼ˆç„¡ç·¨è¼¯æ¬Šé™ï¼‰** | âŒ ç„¡æ¬Šé™ | âŒ éŒ¯èª¤è¨Šæ¯ | âŒ ç„¡ |
| **éåœ˜éšŠæˆå“¡** | âŒ ç„¡æ¬Šé™ | âŒ éŒ¯èª¤è¨Šæ¯ | âŒ ç„¡ |

