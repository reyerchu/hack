# NFT 系統使用指南

## 快速開始

### 給管理員：如何創建 NFT 活動

#### 第一步：訪問管理員頁面

```
http://localhost:3009/admin/nft/campaigns
```

**重要**：此頁面只有 `super_admin` 權限的用戶可以訪問。

如果看到「此頁面僅限管理員訪問」，請聯繫系統管理員設置權限。

#### 第二步：創建新活動

1. 點擊「建立新活動」按鈕
2. 填寫活動資訊：

   ```
   活動名稱：RWA Hackathon Taiwan 參與紀念 NFT
   活動描述：感謝參與第一屆 RWA 黑客松台灣
   圖片：上傳 NFT 圖片（建議 1:1 比例，至少 512x512）
   區塊鏈網路：選擇 Sepolia (測試網)
   供應量：100
   白名單 Email：
     user1@example.com
     user2@example.com
     user3@example.com
   結束日期：2025-12-31
   ```

3. 點擊「建立活動」

#### 第三步：自動部署

活動創建後，會出現「自動設置」按鈕：

1. 點擊「自動設置」
2. 系統會自動執行以下步驟：

   ```
   ⏳ 正在上傳到 IPFS...
   ✅ IPFS 上傳完成
   
   🔗 請連接錢包
   [連接 MetaMask] ← 點擊這個按鈕
   
   ✅ 錢包已連接
   
   📝 正在部署合約...
   [確認] ← 在 MetaMask 中確認交易
   
   ✅ 合約部署完成
   
   🌳 正在設置白名單...
   [確認] ← 在 MetaMask 中確認交易
   
   ✅ 白名單設置完成
   
   🎉 正在啟用鑄造...
   [確認] ← 在 MetaMask 中確認交易
   
   ✅ 設置完成！
   ```

3. 完成！現在用戶可以開始鑄造 NFT 了

#### 第四步：監控和管理

在活動列表頁面，你可以看到：

- 活動狀態（進行中/已結束）
- 目前鑄造進度
- 合約地址
- 點擊活動查看詳細資訊

---

### 給用戶：如何鑄造 NFT

#### 第一步：檢查資格

1. 登入系統
2. 訪問你的個人頁面：
   ```
   http://localhost:3009/user/[你的用戶ID]
   ```
3. 向下滾動到「NFT 紀念品」區域
4. 如果你符合資格，會看到「鑄造 NFT」按鈕

#### 第二步：進入鑄造頁面

1. 點擊「鑄造 NFT」按鈕
2. 跳轉到鑄造頁面：
   ```
   http://localhost:3009/nft/mint?campaign=xxx
   ```

#### 第三步：連接錢包

1. 點擊「連接錢包」
2. MetaMask 會彈出授權視窗
3. 點擊「連接」

#### 第四步：切換網路（如需要）

如果你目前不在正確的網路：

1. 系統會顯示「切換到 Sepolia 網路」按鈕
2. 點擊按鈕
3. MetaMask 會彈出切換網路的請求
4. 點擊「切換網路」

#### 第五步：鑄造 NFT

1. 點擊「鑄造 NFT」按鈕
2. MetaMask 會彈出交易確認視窗
3. 檢查 gas 費用
4. 點擊「確認」
5. 等待交易完成（通常幾秒到幾分鐘）

#### 第六步：完成！

鑄造成功後：

- ✅ 看到「鑄造成功」訊息
- 🔗 可以點擊「在區塊鏈瀏覽器查看」查看交易
- 🎨 可以點擊「查看 NFT 詳情」查看你的 NFT
- 🔙 可以點擊「返回個人頁面」

#### 第七步：查看你的 NFT

回到個人頁面：

- 原本的「鑄造 NFT」按鈕變成「已鑄造」標記
- 顯示 Token ID
- 可以點擊「查看交易記錄」

---

### 給所有人：如何查看 NFT 詳情

#### 公開頁面

每個 NFT 活動都有一個公開頁面，**任何人都可以查看**，無需登入：

```
http://localhost:3009/nft/[活動ID]
```

#### 你可以看到：

1. **NFT 資訊**
   - 大圖展示
   - 活動名稱和描述
   - 區塊鏈網路
   - 智能合約地址（可點擊查看 Etherscan）
   - 鑄造進度
   - 截止日期

2. **鑄造記錄**
   - Token ID
   - 鑄造用戶
   - 鑄造時間
   - 交易哈希（可點擊查看 Etherscan）

#### 如何找到公開頁面？

**方法 1：從管理員頁面**
```
http://localhost:3009/admin/nft/campaigns
→ 點擊任何活動的圖片或名稱
→ 跳轉到公開頁面
```

**方法 2：從用戶頁面**
```
http://localhost:3009/user/[用戶ID]
→ 找到「NFT 紀念品」區域
→ 點擊任何 NFT 卡片
→ 跳轉到公開頁面
```

**方法 3：直接訪問**
```
複製活動 ID，然後訪問：
http://localhost:3009/nft/[活動ID]
```

**方法 4：分享連結**
```
直接分享公開頁面的連結給任何人
他們無需登入即可查看
```

---

## 常見問題

### Q1: 我看不到「NFT 紀念品」區域

**A:** 可能的原因：
1. 你沒有登入 → 請先登入
2. 你不符合任何 NFT 活動的資格 → 請確認你的 email 在白名單中
3. 目前沒有進行中的 NFT 活動 → 請等待管理員創建活動

### Q2: 點擊「鑄造 NFT」後沒有反應

**A:** 請檢查：
1. 是否已安裝 MetaMask？
2. MetaMask 是否已解鎖？
3. 瀏覽器是否阻擋了彈出視窗？
4. 打開瀏覽器的開發者工具（F12）查看錯誤訊息

### Q3: 交易失敗了怎麼辦？

**A:** 常見原因：
1. **Gas 費用不足** → 增加你的錢包餘額
2. **已經鑄造過** → 每個 email 只能鑄造一次
3. **不在白名單** → 確認你的 email 在白名單中
4. **活動已結束** → 鑄造期限已過

### Q4: NFT 圖片不顯示

**A:** 請檢查：
1. IPFS 連線是否正常
2. 等待幾分鐘，IPFS 需要時間傳播
3. 嘗試刷新頁面
4. 聯繫管理員檢查 Base URI 設定

詳見：`FIX-NFT-IMAGE.md`

### Q5: 我想給多個人白名單資格

**A:** 在創建活動時，在「白名單 Email」欄位輸入多個 email，每行一個：

```
user1@example.com
user2@example.com
user3@example.com
...
```

### Q6: 可以修改已創建的活動嗎？

**A:** 目前不支援修改。如需修改：
1. 暫停目前的活動
2. 創建新的活動
3. 或直接在 Firestore 中手動修改（需要技術知識）

### Q7: 如何查看所有鑄造記錄？

**A:** 訪問 NFT 公開頁面：
```
http://localhost:3009/nft/[活動ID]
```
向下滾動到「鑄造記錄」區域，可以看到所有鑄造記錄。

### Q8: 管理員頁面提示「Forbidden: Admin access required」

**A:** 你沒有管理員權限。請聯繫系統管理員執行：

```bash
node scripts/set-admin.js your-email@example.com
```

詳見：`ADMIN-ACCESS-SETUP-COMPLETE.md`

### Q9: 如何在不同網路部署？

**A:** 在創建活動時，選擇不同的「區塊鏈網路」：
- **Sepolia** - 測試網（推薦用於測試）
- **Arbitrum** - Layer 2（低 gas 費用）
- **Mainnet** - 主網（正式環境，需要真實 ETH）

確保你的 MetaMask 有該網路的 ETH 作為 gas 費用。

### Q10: 可以一次鑄造多個 NFT 嗎？

**A:** 目前每個 email 只能鑄造一個 NFT。如需多個：
- 創建多個活動
- 或使用不同的 email

---

## 最佳實踐

### 給管理員

1. **測試先行**
   - 在測試網（Sepolia）先測試
   - 確認一切正常後再部署到主網

2. **圖片規格**
   - 建議 1:1 比例（正方形）
   - 至少 512x512 像素
   - 建議 1024x1024 或更高
   - 格式：PNG, JPEG

3. **供應量設定**
   - 根據白名單人數設定
   - 建議稍微多一點（+10%）以防需要補發

4. **白名單管理**
   - 確保 email 格式正確
   - 一行一個 email
   - 不要有多餘空格

5. **時程安排**
   - 提前部署合約
   - 給用戶足夠的鑄造時間
   - 設定合理的截止日期

### 給用戶

1. **準備工作**
   - 確保安裝 MetaMask
   - 確保有足夠的 ETH 作為 gas 費用
   - 確認網路正確

2. **鑄造時機**
   - 避開網路擁堵時段
   - 不要在截止日期最後一刻鑄造

3. **保存記錄**
   - 截圖交易哈希
   - 保存 Token ID
   - 記錄合約地址

---

## 系統架構圖

```
┌─────────────────────────────────────────────────────────┐
│                      用戶界面                             │
├─────────────────┬───────────────┬──────────────────────┤
│   管理員頁面      │   用戶頁面     │      公開頁面          │
│   (需要權限)     │   (需要登入)   │    (任何人)           │
│                 │               │                      │
│ • 創建活動       │ • 查看資格     │ • 查看活動資訊        │
│ • 自動部署       │ • 鑄造 NFT     │ • 查看鑄造記錄        │
│ • 監控狀態       │ • 查看已鑄造   │ • 分享連結           │
└─────────────────┴───────────────┴──────────────────────┘
                         ↓
┌─────────────────────────────────────────────────────────┐
│                      API 層                              │
├─────────────────┬───────────────┬──────────────────────┤
│   Admin API     │   User API    │    Public API        │
│                 │               │                      │
│ /api/admin/nft/ │ /api/nft/     │ /api/nft/campaigns/  │
└─────────────────┴───────────────┴──────────────────────┘
                         ↓
┌─────────────────────────────────────────────────────────┐
│                    資料層                                │
├──────────────────────────┬──────────────────────────────┤
│     Firebase Firestore    │         IPFS (Pinata)        │
│                          │                              │
│ • nft-campaigns          │ • NFT 圖片                    │
│ • nft-mints              │ • Metadata JSON              │
│ • users                  │                              │
└──────────────────────────┴──────────────────────────────┘
                         ↓
┌─────────────────────────────────────────────────────────┐
│                   區塊鏈層                                │
│                                                         │
│  ERC-721 Smart Contract                                 │
│  • Merkle Tree 白名單                                    │
│  • 鑄造功能                                              │
│  • Token URI                                            │
│                                                         │
│  支援網路：Ethereum, Sepolia, Arbitrum                   │
└─────────────────────────────────────────────────────────┘
```

---

## 下一步

### 你現在可以：

1. **管理員**：
   - 訪問 http://localhost:3009/admin/nft/campaigns
   - 創建第一個 NFT 活動
   - 部署智能合約
   - 監控鑄造狀態

2. **用戶**：
   - 訪問你的個人頁面
   - 檢查是否有可鑄造的 NFT
   - 鑄造你的第一個 NFT

3. **訪客**：
   - 訪問任何 NFT 活動的公開頁面
   - 查看鑄造記錄
   - 分享連結

### 需要幫助？

查看相關文檔：
- `NFT-SYSTEM-OVERVIEW.md` - 系統完整概覽
- `NFT-QUICK-START.md` - 快速開始
- `NFT-DEBUG-GUIDE.md` - 問題排查
- `ADMIN-ACCESS-SETUP-COMPLETE.md` - 管理員設定

---

**版本**：v2.0  
**最後更新**：2025-11-09  
**狀態**：✅ 已完成並測試

